<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Atacad√£o-TV</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" th:href="@{/img/css/bootstrap.min.css}">
  <script th:src="@{/img/js/bootstrap.bundle.min.js}"></script>
  <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico?v=1}" />
  <!-- Meta tags para configura√ß√£o do sistema -->
  <meta name="auto-update-interval" content="30s">
  <meta name="auto-update-url" th:content="@{/{categoria}/{numero}(categoria=${categoria}, numero=${numero})}">
  <meta name="auto-update-target" content="#main-content, body">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden; /* Remove scroll */
    }

    .video-container,
    .image-container {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #000;
      position: relative;
    }

    video, img {
      max-width: 100vw;
      max-height: 100vh;
      width: auto;
      height: auto;
      object-fit: contain;
    }

    .produto-item {
      border: 1px solid transparent;
      padding: 0.25rem 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
    }

    .produtos {
      height: 80vh;
      background-color: rgba(10,10,10,0.9);
      backdrop-filter: blur(12px);
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
      border-radius: 1rem;
      overflow-y: auto;
      padding: 1rem;
    }

    /* Informa√ß√µes da TV */
    .tv-info {
      display: none;
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 12px;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .tv-info.priority-active {
      display: none;
      background: rgba(40, 167, 69, 0.9);
      border: 2px solid #28a745;
      animation: glow 2s infinite alternate;
    }
    /* Debug info */
    .debug-info {
      display: none;
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      z-index: 1000;
      font-family: monospace;
    }

    /* Status verifica√ß√£o */
    .status-verificacao {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      z-index: 1000;
    }

    .status-verificacao.ativo {
      display: none;
      background: rgba(40, 167, 69, 0.9);
      border: 2px solid #28a745;
    }

    @keyframes glow {
      from { box-shadow: 0 0 10px rgba(40, 167, 69, 0.5); }
      to { box-shadow: 0 0 20px rgba(40, 167, 69, 0.8); }
    }

    /* Status de agendamento */
    .agendamento-status {
      display: none;
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 12px;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .agendamento-status.ativo {
      display: none;
      background: rgba(40, 167, 69, 0.9);
      border: 2px solid #28a745;
    }

    /* Loading overlay */
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: white;
      font-size: 18px;
      font-weight: bold;
    }

    .loading-overlay.show {
      display: none;
    }

    /* CSS Tailwind reduzido (mantendo apenas o necess√°rio) */
    .text-center { text-align: center; }
    .text-white { color: white; }
    .text-gray-500 { color: #6b7280; }
    .text-warning { color: #ffc107; }
    .fs-1 { font-size: 2.5rem; }
    .fw-bold { font-weight: bold; }
    .fw-normal { font-weight: normal; }
    .text-uppercase { text-transform: uppercase; }
    .text-nowrap { white-space: nowrap; }
    .d-flex { display: flex; }
    .flex-column { flex-direction: column; }
    .align-items-center { align-items: center; }
    .align-items-end { align-items: flex-end; }
    .align-items-start { align-items: flex-start; }
    .justify-content-center { justify-content: center; }
    .justify-content-start { justify-content: flex-start; }
    .justify-content-between { justify-content: space-between; }
    .gap-1 { gap: 0.25rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .w-100 { width: 100%; }
    .col-4 { width: 33.333333%; }
    .col-8 { width: 66.666667%; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .px-lg-5 { padding-left: 3rem; padding-right: 3rem; }
    .pt-2 { padding-top: 0.5rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .mt-4 { margin-top: 1.5rem; }
    .mb-0 { margin-bottom: 0; }
    .mb-1 { margin-bottom: 0.25rem; }
    .m-0 { margin: 0; }
    .bg-dark { background-color: #000; }
    .bg-opacity-50 { background-color: rgba(33, 37, 41, 0.5); }
    .rounded-3 { border-radius: 0.5rem; }
    .rounded-4 { border-radius: 1rem; }
    .border { border: 1px solid; }
    .border-2 { border-width: 2px; }
    .border-warning { border-color: #ffc107; }
    .small { font-size: 0.875rem; }
    .text-end { text-align: right; }

    @media (min-width: 1024px) {
      .px-lg-5 { padding-left: 3rem; padding-right: 3rem; }
    }

    .produto-item {
      display: none;
      transition: opacity 1s ease;
    }
    .produto-item.mostrar {
      display: flex;
    }

    .linha{
      background-color: rgba(255, 255, 255, 0.3);
    }
  </style>
</head>
<body th:style="'background-image: url(' + @{/img/background/{cat}.png(cat=${categoria})} + ');
                 background-size: cover;
                 background-repeat: no-repeat;
                 background-color: #000;'" id="app">
<!-- Debug Info -->
<div id="debug-info" class="debug-info show">
  <div><strong>üñ•Ô∏è TV:</strong> <span id="debug-tv">Loading...</span></div>
  <div><strong>üìã Conte√∫do:</strong> <span id="debug-content">Loading...</span></div>
  <div><strong>‚è∞ √öltima verifica√ß√£o:</strong> <span id="debug-last-check">Nunca</span></div>
  <div><strong>‚è±Ô∏è Pr√≥xima em:</strong> <span id="debug-countdown">30s</span></div>
  <div><strong>üìä Status:</strong> <span id="debug-status">Iniciando...</span></div>
  <div><strong>üîÑ Verifica√ß√µes:</strong> <span id="debug-checks">0</span></div>
  <div><strong>‚ùå Erros:</strong> <span id="debug-errors">0</span></div>
</div>

<!-- TV Info -->
<div id="tv-info" class="tv-info">
  <div><strong>üì∫ TV:</strong> <span id="tv-display">Loading...</span></div>
  <div><strong>üìä Status:</strong> <span id="tv-status">Iniciando...</span></div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="loading-overlay">
  <div>üîÑ Carregando...</div>
</div>

<div id="main-content">
  <!-- Imagem -->
  <div class="image-container" th:id="divImagem" th:if="${tipoConteudo == 1}" th:align="center">
    <img th:src="${caminhoCompletoArquivo}" alt="Conte√∫do de imagem">
  </div>

  <!-- Video -->
  <div class="video-container" th:id="divVideo" th:if="${tipoConteudo == 2}" th:align="center">
     <video autoplay muted loop controls
           th:onloadstart="'console.log(\'Iniciando carregamento do v√≠deo:\', this.currentSrc);'"
           th:oncanplay="'console.log(\'V√≠deo pronto para reproduzir:\', this.currentSrc);'"
           th:onerror="'console.error(\'Erro no v√≠deo:\', this.error); document.getElementById(\'media-debug\').classList.add(\'show\');'">

      <!-- M√∫ltiplas sources para compatibilidade -->
      <source th:src="${caminhoCompletoArquivo}" type="video/mp4">
      <source th:src="${caminhoCompletoArquivo}" type="video/webm">
      <source th:src="${caminhoCompletoArquivo}" type="video/ogg">

      <!-- Fallback -->
      <p>Seu navegador n√£o suporta v√≠deos em HTML5.</p>
      <p>Tentando carregar: <span th:text="${caminhoCompletoArquivo}">arquivo n√£o encontrado</span></p>
    </video>
  </div>

  <!-- Tabela de Pre√ßos -->
  <div class="d-flex gap-4" th:id="tabelaPreco" th:if="${tipoConteudo == 3}">
    <div class="col-4"></div>
    <div class="col-8 d-flex flex-column gap-4 px-4 px-lg-5 mt-4">

      <!-- Cabe√ßalho Categoria -->
      <div class="w-100 pt-2 d-flex align-items-center">
        <div class="d-flex justify-content-center align-items-center w-100 bg-dark bg-opacity-50 rounded-4 border border-2 border-warning py-2">
          <h1 class="fs-1 fw-bold text-warning text-uppercase" th:text="${descCategoria}">Departamento</h1>
        </div>
      </div>

      <!-- Lista de Produtos -->
      <div class="w-100">
        <div class="produtos" id="lista-produtos">
          <!-- Produto renderizado via Thymeleaf -->
          <div class="produto-item rounded-3 small"
               th:each="produto, stat : ${produtos}"
               th:classappend="${stat.index % 2 == 0} ? 'linha' : ''">
            <div class="d-flex flex-column gap-1 justify-content-start align-items-start ">
              <div class="d-flex align-items-end gap-4 ">
                <h3 class="text-white fs-1 text-nowrap m-0 fw-normal" th:text="${produto.nome.trim()}"></h3>
                <h3 class="text-white fs-1 text-nowrap m-0 fw-normal">-</h3>
                <h5 class="text-white fs-1 m-0 fw-normal" th:text="${produto.abreviacaoUM}">kg</h5>
              </div>
            </div>
            <div class="d-flex align-items-end gap-3 text-end">
              <div th:if="${produto.precoPromocao > 0}">
                <p class="small text-white mb-1">
                  De: <s>R$ <span th:text="${#numbers.formatDecimal(produto.preco, 1, 'POINT', 2, 'COMMA')}">0,00</span></s>
                </p>
                <p class="fs-1 text-white mb-0">
                  Por: R$ <span th:text="${#numbers.formatDecimal(produto.precoPromocao, 1, 'POINT', 2, 'COMMA')}">0,00</span>
                </p>
              </div>
              <div th:unless="${produto.precoPromocao > 0}">
                <p class="preco fs-1 text-white mb-0">
                  R$ <span th:text="${#numbers.formatDecimal(produto.preco, 1, 'POINT', 2, 'COMMA')}">0,00</span>
                </p>
              </div>
            </div>
          </div>
          <!-- Caso nenhum produto -->
          <div th:if="${#lists.isEmpty(produtos)}" class="text-center text-gray-500">
            <h3>üì¶ Nenhum produto encontrado</h3>
            <p>Aguardando produtos para <span th:text="${categoria}">categoria</span></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts de configura√ß√£o inseridos via Thymeleaf -->
<script th:inline="javascript">
  // Configura√ß√µes da TV passadas pelo controller
  const TV_CONFIG = {
    categoria: /*[[${categoria}]]*/ 'categoria',
    numero: /*[[${numero}]]*/ 0,
    baseUrl: /*[[${baseUrl}]]*/ 'http://localhost:8081/api-tv/',
    intervaloVerificacao: /*[[${intervaloVerificacao}]]*/ 30000,
    tipoConteudo: /*[[${tipoConteudo}]]*/ 1,
    conteudoTitulo: /*[[${conteudoTitulo}]]*/ '',
    conteudoDescricao: /*[[${conteudoDescricao}]]*/ '',
    agendamentosAtivos: /*[[${agendamentosAtivos}]]*/ 0,
    qtdeLinhas: /*[[${qtdeLinhas}]]*/ 8,
    caminhoArquivo: /*[[${caminhoCompletoArquivo}]]*/ ''
  };

  console.log('üéØ TV Configurada:', TV_CONFIG);
  console.log('üì¶ Categoria atual:', TV_CONFIG.categoria);
  console.log('üìã Agendamentos ativos:', TV_CONFIG.agendamentosAtivos);
</script>
<!-- Script principal da TV -->
<script>
  let verificacaoInterval = null;
  let contadorInterval = null;
  let rolagemInterval = null;
  let isRedirecting = false;
  let contadorVerificacao = 30;
  let totalVerificacoes = 0;
  let totalErros = 0;

  function atualizarDebugInfo() {
    const debugElements = {
      'debug-tv': `${TV_CONFIG.categoria}/${TV_CONFIG.numero}`,
      'debug-content': `Tipo ${TV_CONFIG.tipoConteudo} - ${TV_CONFIG.conteudoTitulo || 'Sem t√≠tulo'}`,
      'debug-countdown': `${contadorVerificacao}s`,
      'debug-checks': totalVerificacoes,
      'debug-errors': totalErros,
      'tv-display': `${TV_CONFIG.categoria}/${TV_CONFIG.numero}`,
      'debug-last-check': new Date().toLocaleTimeString('pt-BR')
    };

    Object.entries(debugElements).forEach(([id, value]) => {
      const element = document.getElementById(id);
      if (element) element.textContent = value;
    });
  }

  function logDebug(message, level = 'info') {
    const timestamp = new Date().toLocaleTimeString('pt-BR');
    const prefix = level === 'error' ? '‚ùå' : level === 'warn' ? '‚ö†Ô∏è' : level === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
    console.log(`${prefix} [${timestamp}] ${message}`);

    // Atualiza status no debug
    const statusElement = document.getElementById('debug-status');
    if (statusElement) {
      statusElement.textContent = message;
      statusElement.style.color = level === 'error' ? '#ff6b6b' : level === 'success' ? '#51cf66' : '#fff';
    }
  }

  // === FUN√á√ÉO DE CONTAGEM REGRESSIVA ===
  function iniciarContador() {
    if (contadorInterval) {
      clearInterval(contadorInterval);
    }

    contadorInterval = setInterval(() => {
      if (!isRedirecting) {
        contadorVerificacao--;
        atualizarDebugInfo();

        if (contadorVerificacao <= 0) {
          contadorVerificacao = 30; // Reset
        }
      }
    }, 1000);
  }

  // Atualiza status visual
  function atualizarStatus(texto, ativo = false) {
    const statusTexto = document.getElementById('status-texto');
    const statusDiv = document.getElementById('status-verificacao');
    const ultimaVerificacao = document.getElementById('ultima-verificacao');

    if (statusTexto) statusTexto.textContent = texto;
    if (ultimaVerificacao) ultimaVerificacao.textContent = new Date().toLocaleTimeString('pt-BR');

    if (statusDiv) {
      if (ativo) {
        statusDiv.classList.add('ativo');
      } else {
        statusDiv.classList.remove('ativo');
      }
    }
  }

  // Atualiza hor√°rio atual
  function atualizarHorario() {
    const agora = new Date();
    const elemento = document.getElementById('current-time');
    if (elemento) {
      elemento.textContent = agora.toLocaleTimeString('pt-BR');
    }
  }

  // Registra que a TV est√° ativa
  async function registrarAtividade() {
    try {
      /*const url = `${TV_CONFIG.baseUrl}/api/tv/${TV_CONFIG.categoria}/${TV_CONFIG.numero}/abrir`;*/
      const url = `/api-tv/api/tv/${TV_CONFIG.categoria}/${TV_CONFIG.numero}/abrir`;

      await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          timestamp: new Date().toISOString(),
          tipoConteudo: TV_CONFIG.tipoConteudo,
          titulo: TV_CONFIG.conteudoTitulo,
          categoria: TV_CONFIG.categoria
        })
      });
      console.log('üìä Atividade registrada para', TV_CONFIG.categoria + '/' + TV_CONFIG.numero);
      atualizarStatus('Registrado', true);
    } catch (error) {
      console.warn('‚ö† Erro ao registrar atividade:', error.message);
      atualizarStatus('Erro no registro', false);
    }
  }

  // Verifica se ainda deve exibir este conte√∫do
  async function verificarStatusAgendamento() {
    if (isRedirecting) {
      console.log('üîÑ J√° est√° redirecionando, pulando verifica√ß√£o');
      return;
    }

    totalVerificacoes++;
    console.log(`Iniciando verifica√ß√£o #${totalVerificacoes}`, 'info');

    try {
      /*const statusUrl = `${TV_CONFIG.baseUrl}/api/tv/${TV_CONFIG.categoria}/${TV_CONFIG.numero}/status`;*/
      const statusUrl = `/api-tv/api/tv/${TV_CONFIG.categoria}/${TV_CONFIG.numero}/status`;

      console.log(`Consultando: ${statusUrl}`, 'info');

      const response = await fetch(statusUrl, {
        method: 'GET',
        headers: {
          'Cache-Control': 'no-cache',
          'Pragma': 'no-cache'
        }
      });

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }

      const status = await response.json();
      console.log(`Status recebido - Deve exibir: ${status.deveExibirConteudo}, Agendamentos: ${status.agendamentosAtivos}`, 'info');

      // Atualiza interface
      atualizarStatus(status, true);

      // VERIFICA√á√ÉO 1: Se n√£o deve mais exibir conte√∫do
      if (!status.deveExibirConteudo) {
        console.log('‚ö†Ô∏è DEVE SAIR - N√£o deve mais exibir conte√∫do', 'warn');
        redirecionarParaStandby('Sem agendamentos ativos');
        return;
      }

      // VERIFICA√á√ÉO 2: Se mudou o agendamento atual (splash vs principal)
      if (status.agendamentoAtual) {

        const tituloAtual = TV_CONFIG.conteudoTitulo || '';
        const novoTitulo = status.agendamentoAtual.titulo || '';

        if (tituloAtual !== novoTitulo) {
          console.log(`üîÑ MUDAN√áA DE AGENDAMENTO DETECTADA:`, 'warn');
          console.log(`   Atual: "${tituloAtual}"`, 'warn');
          console.log(`   Novo:  "${novoTitulo}"`, 'warn');
          recarregarConteudo('Agendamento mudou');
          return;
        }
      }

      // Reset contador ap√≥s verifica√ß√£o bem-sucedida
      contadorVerificacao = 30;
      console.log(`‚úÖ Verifica√ß√£o #${totalVerificacoes} conclu√≠da - Tudo OK`, 'success');
      atualizarDebugInfo();

    } catch (error) {
      totalErros++;
      console.log(`‚ùå Erro na verifica√ß√£o #${totalVerificacoes}: ${error.message}`, 'error');
      atualizarStatus(error.message, null);
      atualizarDebugInfo();
    }
  }

  // Redireciona para standby
  function redirecionarParaStandby(motivo = 'Standby necess√°rio') {
    if (isRedirecting) return;

    isRedirecting = true;
    console.log(`üîÑ REDIRECIONANDO PARA STANDBY: ${motivo}`, 'warn');

    // Limpa todos os intervals
    clearAllIntervals();

    // Mostra loading
    const loading = document.getElementById('loading-overlay');
    if (loading) {
      loading.classList.add('show');
      loading.innerHTML = `<div>üîÑ ${motivo}<br>Redirecionando...</div>`;
    }

    // Redireciona
    setTimeout(() => {
      window.location.href = `/tv?categoria=${TV_CONFIG.categoria}&numero=${TV_CONFIG.numero}`;
    }, 2000);
  }

  function recarregarConteudo(motivo = 'Atualizando conte√∫do') {
    if (isRedirecting) return;

    isRedirecting = true;
    console.log(`üîÑ RECARREGANDO CONTE√öDO: ${motivo}`, 'warn');

    // Limpa todos os intervals
    clearAllIntervals();

    // Mostra loading
    const loading = document.getElementById('loading-overlay');
    if (loading) {
      loading.classList.add('show');
      loading.innerHTML = `<div>üîÑ ${motivo}<br>Recarregando...</div>`;
    }


  }

  function clearAllIntervals() {
    if (verificacaoInterval) {
      clearInterval(verificacaoInterval);
      verificacaoInterval = null;
    }
    if (contadorInterval) {
      clearInterval(contadorInterval);
      contadorInterval = null;
    }
    if (rolagemInterval) {
      clearInterval(rolagemInterval);
      rolagemInterval = null;
    }
  }

  // === ROLAGEM DE PRODUTOS COM FADE ===
  function inicializarRolagemProdutos() {
    const items = document.querySelectorAll(".produto-item");
    if (items.length === 0) return;

    console.log(`üì¶ Iniciando fade de ${items.length} produtos`, 'info');

    const step = parseInt(`${TV_CONFIG.qtdeLinhas}`, 10);
    let currentIndex = 0;
    console.log(`üì¶ Obtendo tamanho do bloco de ${TV_CONFIG.qtdeLinhas}`, 'info');
    function mostrarBloco(index) {
      console.log(`üì¶ Vai exibir bloco`, 'info');
      // Esconde todos
      items.forEach(item => item.classList.remove("mostrar"));

      // Mostra de index at√© index+step
      console.log(`üì¶ Vai montar bloco`, 'info');
      for (let i = index; i < index + step && i < items.length; i++) {
        if(i==index){
          console.log(`üì¶ Vai exibir do `+ i + ` at√© ` + index + step, 'info');
        }
        items[i].classList.add("mostrar");
      }
    }

    // Limpa interval anterior se existir
    if (rolagemInterval) {
      clearInterval(rolagemInterval);
    }

    // Mostra primeiro bloco
    mostrarBloco(currentIndex);

    // Troca blocos a cada 8s
    rolagemInterval = setInterval(() => {
      console.log(`üì¶ Entrou para verificar se exibe pr√≥ximo bloco `, 'info');
      if (!isRedirecting) {
        currentIndex += step;
        console.log(`üì¶ Atual √© ` + currentIndex, 'info');
        console.log(`üì¶ Total √© ` + items.length, 'info');
        if (currentIndex >= items.length) {
          currentIndex = 0; // volta para o in√≠cio
        }
        console.log(`üì¶ Vai montar bloco novo depois de 8 s `, 'info');
        mostrarBloco(currentIndex);
      }
    }, 8000);
  }

  // === INICIALIZA√á√ÉO ===
  document.addEventListener("DOMContentLoaded", function () {
    console.log(`üé¨ Iniciando TV: ${TV_CONFIG.categoria}/${TV_CONFIG.numero}`, 'info');
    console.log(`üì¶ Tipo de conte√∫do: ${TV_CONFIG.tipoConteudo}`, 'info');
    console.log(`üìã T√≠tulo: ${TV_CONFIG.conteudoTitulo}`, 'info');

    // Atualiza debug inicial
    atualizarDebugInfo();

    // Registra atividade inicial
    registrarAtividade();

    // Inicia contador visual
    iniciarContador();

    // Inicia rolagem de produtos se necess√°rio
    if (TV_CONFIG.tipoConteudo === 3) {
      setTimeout(inicializarRolagemProdutos, 1000);
    }

    // === CONFIGURA√á√ÉO DA VERIFICA√á√ÉO AUTOM√ÅTICA ===
    console.log('‚è∞ Configurando verifica√ß√£o autom√°tica a cada 30s', 'info');

    verificacaoInterval = setInterval(() => {
      if (!isRedirecting) {
        console.log('üîî Executando verifica√ß√£o autom√°tica', 'info');
        verificarStatusAgendamento();
      }
    }, 30000); // 30 segundos

    // Primeira verifica√ß√£o ap√≥s 5 segundos
    setTimeout(() => {
      console.log('üé¨ Executando primeira verifica√ß√£o', 'info');
      verificarStatusAgendamento();
    }, 3600000); //30000); //5000);
    console.log('‚úÖ TV inicializada com sucesso', 'success');
  });

  // === LIMPEZA AO SAIR ===
  window.addEventListener('beforeunload', function() {
    console.log('üëã Limpando intervals antes de sair', 'info');
    clearAllIntervals();
  });

  // === FUN√á√ïES DE DEBUG MANUAL ===
  window.forcarVerificacao = function() {
    console.log('üîß Verifica√ß√£o manual for√ßada', 'info');
    verificarStatusAgendamento();
  };

  window.debugTV = function() {
    console.log('=== üîç DEBUG TV ===');
    console.log('Configura√ß√£o:', TV_CONFIG);
    console.log('Estado redirecionamento:', isRedirecting);
    console.log('Interval verifica√ß√£o ativo:', verificacaoInterval !== null);
    console.log('Pr√≥xima verifica√ß√£o em:', contadorVerificacao + 's');
    console.log('Total verifica√ß√µes:', totalVerificacoes);
    console.log('Total erros:', totalErros);
    console.log('=================');
  };

  window.forcarReload = function() {
    console.log('üîß Reload manual for√ßado', 'warn');
    recarregarConteudo('Reload manual');
  };

  window.forcarStandby = function() {
    console.log('üîß Standby manual for√ßado', 'warn');
    redirecionarParaStandby('Standby manual');
  };
</script>
<!-- Bootstrap JS -->
<script th:src="@{/img/js/popper.min.js}"></script>
<script th:src="@{/img/js/bootstrap.min.js}"></script>
<button id="exitFullscreenBtn" style="position:fixed;top:10px;right:10px;width:40px;height:40px;opacity:0;z-index:999;border:none;background:none;cursor:pointer;"></button>
<script>
    document.getElementById("exitFullscreenBtn").addEventListener("click", function () {
        if (document.fullscreenElement) {
            document.exitFullscreen();
        }else{
          document.documentElement.requestFullscreen();
        }
    });
</script>
</body>
</html>